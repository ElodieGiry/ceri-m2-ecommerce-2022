name: Actions Back et Front et Deploy pour Terraform 
on:
  push:
    branches:
      - "main"
jobs:
  Back:
    steps:
      - use checkout
      - run : pip install -r requirements.txt
      - run : pytest test
      - run : docker build -t Backend .
  Front:
    steps:
      - use checkout
      - run : ng test
      - run : nmp install
      - run : ng build --prod
      - run : docker build -t Frontend .
  deploy:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: terraform
    steps:
      - uses: actions/checkout@v2
      - uses: hashicorp/setup-terraform@v2
        with:
          cli_config_credentials_token: ${{ secrets.TF_TOKEN }}
      - run: terraform init
      - run: terraform apply -auto-approve -input=False
